# j谷粒商城笔记梗概

## 分布式组件使用

### nacos  注册发现

安装启动nacos：下载–解压–双击bin/startup.cmd。http://127.0.0.1:8848/nacos/ 账号密码nacos

在某个项目里properties里写spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848（yaml同理，指定nacos的地址）。再指定applicatin.name告诉注册到nacos中以什么命名

依赖：放到common里，不写版本是因为里面有了版本管理

<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
使用 @EnableDiscoveryClient 注解开启服务注册与发现功能

```java
@SpringBootApplication
@EnableDiscoveryClient
public class ProviderApplication {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }

    @RestController
    class EchoController {
        @GetMapping(value = "/echo/{string}")
        public String echo(@PathVariable String string) {
            return string;
        }
    }
}

```

在application.yml中加入nacos地址和模块名

### OpenFeign 服务调用

```
/**
 * 想要远程调用别的服务
 * 1  引入openfeign
 <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-openfeign</artifactId>
        </dependency>
 * 2  编写接口告诉springcloud去调用远程服务  放在feign包下
 *      2.1 声明接口的每个方法都调用哪个远程服务的哪个请求
 * 3 开启远程调用功能
 @EnableFeignClients(basePackages = "com.atguigu.gulimall.member.feign")
 */
```

### nacos配置中心

```
/**
 * 如何使用nacos配置中心统一管理依赖
 *
 * 1 引入依赖
 * 2 创建一个bootstrap.properties
 *       写上
 *      当前应用名字
 *      配置中心服务器地址
 * 3 给配置中心默认添加一个数据集gulimall-peoperties（默认规则：应用名.properties）
 * 4 给gulimall-peoperties添加配置
 * 5 动态获取配置@RefreshScope  优先使用配置中心的属性
 */
```



命名空间：用作配置隔离。（一般每个微服务一个命名空间）

默认public。默认新增的配置都在public空间下

开发、测试、开发可以用命名空间分割。properties每个空间有一份。

在bootstrap.properties里配置（测试完去掉，学习不需要）

```
# 可以选择对应的命名空间 # 写上对应环境的命名空间ID
spring.cloud.nacos.config.namespace=b176a68a-6800-4648-833b-be10be8bab00

```


也可以为每个微服务配置一个命名空间，微服务互相隔离

配置集：一组相关或不相关配置项的集合。

配置集ID：类似于配置文件名，即Data ID

配置分组：默认所有的配置集都属于DEFAULT_GROUP。双十一，618的优惠策略改分组即可

 

```
# 更改配置分组
spring.cloud.nacos.config.group=DEFAULT_GROUP
```

```
# 改名字，对应nacos里的配置文件名
spring.application.name=gulimall-coupon
spring.cloud.nacos.config.server-addr=127.0.0.1:8848

# 可以选择对应的命名空间 # 写上对应环境的命名空间ID
spring.cloud.nacos.config.namespace=136019e9-562f-412b-87b7-df207f9d2305
spring.cloud.nacos.config.group=prod

spring.cloud.nacos.config.ext-config[0].data-id=datasource.yml
spring.cloud.nacos.config.ext-config[0].group=dev
spring.cloud.nacos.config.ext-config[0].refresh=true

spring.cloud.nacos.config.ext-config[1].data-id=mybatis.yml
spring.cloud.nacos.config.ext-config[1].group=dev
spring.cloud.nacos.config.ext-config[1].refresh=true

spring.cloud.nacos.config.ext-config[2].data-id=other.yml
spring.cloud.nacos.config.ext-config[2].group=dev
spring.cloud.nacos.config.ext-config[2].refresh=true
```

### 网关gateway-88

网关是请求流量的入口，常用功能包括路由**转发，权限校验，限流控制**等。springcloud `gateway`取代了`zuul`网关。



1  配置nacos地址，命名空间

2  gateway

```
spring:
  cloud:
    gateway:
      routes:
        - id: test_route
          uri: https://www.baidu.com
          predicates:
            - Query=url,baidu

        - id: qq_route
          uri: https://www.qq.com
          predicates:
            - Query=url,qq
```





## js速成

## 后端-三级分类列表

流式编程  lambda表达式



## 配置跨域请求

```java
@Configuration
public class GulimallCorsConfiguration {

    @Bean
    public CorsWebFilter corsWebFilter(){
        UrlBasedCorsConfigurationSource source =
                new UrlBasedCorsConfigurationSource();
        CorsConfiguration corsConfiguration = new CorsConfiguration();

        //1,配置跨域
        corsConfiguration.addAllowedHeader("*");//允许哪些头进行跨域
        corsConfiguration.addAllowedMethod("*");//允许哪些方法进行跨域
        corsConfiguration.addAllowedOrigin("*");//允许哪些请求来源跨域
        corsConfiguration.setAllowCredentials(true);//是否允许携带cookie进行跨域

        //  /** ---任意路径都要进行跨域配置
        source.registerCorsConfiguration("/**",corsConfiguration);
        return new CorsWebFilter(source);
    }
}

```

## 前端-三级分类列表

element-ui

category.vue

## 三级菜单的删除功能

逻辑删除，将某个字段作为标识位，标识是否删除

MyBatis逻辑删除：



  1.

```
mybatis-plus:
  global-config:
    db-config:
      logic-delete-field: flag  # 全局逻辑删除的实体字段名(since 3.3.0,配置后可以忽略不配置步骤2)
      logic-delete-value: 1 # 逻辑已删除值(默认为 1)
      logic-not-delete-value: 0 # 逻辑未删除值(默认为 0)
```

2.加上逻辑删除注解

或者在逻辑字段上添加`@TableLogic`，自己配置

```
/**
 * 是否显示[0-不显示，1显示]
 */
@TableLogic(value = "1",delval = "0")
```